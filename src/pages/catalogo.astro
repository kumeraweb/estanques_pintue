---
import BaseLayout from '../layouts/BaseLayout.astro'
import { MessageCircle } from 'lucide-astro'
import { supabase } from '../lib/supabase'
import { LINKS } from '../data/site'

// Obtener productos
const { data: products, error } = await supabase
  .from('products')
  .select('*')
  .order('category', { ascending: true })

if (error) console.error('Error cargando productos:', error)

// Armar categorías
const catalog: Record<string, any[]> = {}

for (const p of products ?? []) {
  const cat = p.category ?? 'Sin categoría'
  if (!catalog[cat]) catalog[cat] = []
  catalog[cat].push(p)
}
---

<BaseLayout title="Catálogo Completo">
  <section class="py-32">
    <div class="max-w-6xl mx-auto px-6">
      <h1 class="section-title mb-4">Catálogo Completo</h1>
      <p class="text-gray-600 mb-12">Estanques, plantas, barricas y más !</p>

      {
        Object.entries(catalog).map(([cat, items]) => (
          <div class="mb-16">
            <h2 class="text-2xl font-bold text-[var(--color-primary)] mb-6 capitalize">{cat}</h2>

            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
              {items.map((item) => (
                <div class="bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition">
                  <img src={item.image_url} class="w-full h-48 object-cover" alt={item.title} />

                  <div class="p-5">
                    <h3 class="text-xl font-semibold text-[var(--color-primary)]">{item.title}</h3>

                    <p class="text-gray-600 text-sm mt-2 mb-4">{item.description}</p>

                    <a
                      href={LINKS.wa(`Hola! Me interesa el producto: ${item.title}`)}
                      target="_blank"
                      class="w-full flex items-center justify-center gap-2 bg-[var(--color-primary)] text-white px-4 py-2 rounded-lg hover:opacity-90 transition font-medium"
                    >
                      <MessageCircle class="w-4 h-4" />
                      Cotizar por WhatsApp
                    </a>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))
      }
    </div>
  </section>
</BaseLayout>
