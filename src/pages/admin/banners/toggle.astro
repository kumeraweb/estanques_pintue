---
export const prerender = false

import { supabase } from '../../../lib/supabase'

// Proteger ruta
const { data: sessionData } = await supabase.auth.getSession()
if (!sessionData.session) return Astro.redirect('/admin/login')

// ID del banner desde query param
const id = Astro.url.searchParams.get('id')
if (!id) return Astro.redirect('/admin/banners')

// Obtener estado actual
const { data: banner } = await supabase.from('banners').select('is_active').eq('id', id).single()

if (!banner) return Astro.redirect('/admin/banners')

// Alternar estado
const newState = !banner.is_active

// Guardar
await supabase.from('banners').update({ is_active: newState }).eq('id', id)

// Volver al listado
return Astro.redirect('/admin/banners')
---
