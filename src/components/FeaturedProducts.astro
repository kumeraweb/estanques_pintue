---
import ProductCard from './ProductCard.astro'
import { supabase } from '../lib/supabase'

// Obtener destacados con categor√≠a incluida
const { data: featured, error } = await supabase
  .from('products')
  .select('*, categories(name)')
  .eq('featured', true)
  .order('created_at', { ascending: false })

if (error) console.error(error)

const featuredList = featured ?? []
---

<section id="destacados" class="py-24 px-6 reveal">
  <div class="max-w-6xl mx-auto text-center mb-12">
    <h2 class="text-4xl font-bold text-[var(--color-primary)] mb-3">¬°Destacados!</h2>
    <p class="text-gray-600 text-lg max-w-2xl mx-auto">
      Los favoritos de nuestros clientes. Visite nuestro cat√°logo completo para conocer m√°s.
    </p>
  </div>

  {
    featuredList.length > 0 ? (
      <>
        <!-- üì± MOBILE: CARRUSEL -->
        <div class="md:hidden flex gap-6 overflow-x-auto whitespace-nowrap pb-4 snap-x snap-mandatory max-w-6xl mx-auto">
          {
            featuredList.map((item) => (
              <div class="min-w-[260px] snap-start">
                <ProductCard
                  title={item.title}
                  description={item.description}
                  price={item.price}
                  image_url={item.image_url}
                  category_name={item.categories?.name}
                  isFeatured={true}
                />
              </div>
            ))
          }
        </div>

        <!-- üñ•Ô∏è DESKTOP: GRID -->
        <div class="hidden md:grid sm:grid-cols-2 lg:grid-cols-3 gap-10 max-w-6xl mx-auto">
          {
            featuredList.map((item) => (
              <ProductCard
                title={item.title}
                description={item.description}
                price={item.price}
                image_url={item.image_url}
                category_name={item.categories?.name}
                isFeatured={true}
              />
            ))
          }
        </div>
      </>
    ) : (
      <p class="text-center text-gray-500 col-span-3 py-6">
        No hay productos destacados por ahora.
      </p>
    )
  }

  <div class="text-center mt-12">
    <a
      href="/catalogo"
      class="inline-block bg-[var(--color-primary)] text-white px-6 py-3 rounded-full font-semibold hover:opacity-90 transition"
    >
      Ver Cat√°logo Completo ‚Üí
    </a>
  </div>
</section>
