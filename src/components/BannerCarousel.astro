---
import { supabase } from '../lib/supabase'

const { data: banners } = await supabase
  .from('banners')
  .select('*')
  .eq('is_active', true)
  .order('created_at', { ascending: false })

if (!banners || banners.length === 0) {
  return null
}
---

<div class="w-full flex justify-center my-5">
  <div class="relative w-[95%] md:w-full md:max-w-[1000px] overflow-hidden">
    <div class="flex gap-4 transition-transform duration-700 ease-out" id="bannerCarousel">
      {
        banners.map((b) => (
          <div class="w-full h-[160px] md:h-[220px] flex-shrink-0">
            <img src={b.image_url} class="w-full h-full object-cover rounded-2xl" />
          </div>
        ))
      }
    </div>

    <div class="absolute bottom-2 w-full flex justify-center gap-2">
      {
        banners.map((_, i) => (
          <div class="w-3 h-3 rounded-full bg-gray-300 banner-dot" data-index={i} />
        ))
      }
    </div>
  </div>
</div>

<script is:inline>
  const carousel = document.getElementById('bannerCarousel')
  const dots = Array.from(document.querySelectorAll('.banner-dot'))
  let index = 0
  const total = dots.length

  const update = () => {
    const slideWidth = carousel.children[0].offsetWidth + 16
    carousel.style.transform = `translateX(-${index * slideWidth}px)`

    dots.forEach((d, i) => {
      d.classList.toggle('active', i === index)
    })
  }

  dots.forEach((dot, i) => {
    dot.addEventListener('click', () => {
      index = i
      update()
    })
  })

  setInterval(() => {
    index = (index + 1) % total
    update()
  }, 4000)

  window.addEventListener('resize', update)
</script>
